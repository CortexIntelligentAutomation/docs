<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.102.3" /><link rel="canonical" type="text/html" href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Grafana | Cortex</title><meta property="og:title" content="Grafana" />
<meta property="og:description" content="Information about adding a Grafana platform to Innovation, including details about components, supported architectures, prerequisites, installation and configuration instructions." />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/" /><meta property="og:site_name" content="Cortex" />

<meta itemprop="name" content="Grafana">
<meta itemprop="description" content="Information about adding a Grafana platform to Innovation, including details about components, supported architectures, prerequisites, installation and configuration instructions."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Grafana"/>
<meta name="twitter:description" content="Information about adding a Grafana platform to Innovation, including details about components, supported architectures, prerequisites, installation and configuration instructions."/>





<link rel="preload" href="/scss/main.min.0891f4e5e1c0bde61105cc497e03ebcbaca32a0d8daea6962bff385b48328a50.css" as="style">
<link href="/scss/main.min.0891f4e5e1c0bde61105cc497e03ebcbaca32a0d8daea6962bff385b48328a50.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_4_copy" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1388 475.1" style="enable-background:new 0 0 1388 475.1"><style>.st0{fill:#3b8fce}.st1{fill:#262056}.st2{fill:#a1c429}.st3{fill:#fff}.st4{fill:url(#SVGID_1_)}.st5{opacity:.6;fill:url(#SVGID_2_)}.st6{filter:url(#Adobe_OpacityMaskFilter)}.st7{fill:url(#SVGID_4_)}.st8{mask:url(#SVGID_3_);fill:#fff}.st9{fill:#3f3f3e}</style><path class="st0" d="M122.1 231.7c0-15.7 3.6-30.5 9.9-43.8l-81.1-46.8c-22.9 43.5-28.5 93.3-15.7 141 13.5 50.3 45.7 92.3 90.8 118.3 29 16.7 56.9 24.9 89.6 26v-93.7c-52.3-4-93.5-47.6-93.5-101z"/><path class="st1" d="M223.5 130.3c34.7.0 65.3 17.5 83.6 44.1l81.1-46.8c-35.6-56.2-98-90.8-164.9-90.8-34 0-67.6 9-97.3 26.1-29 16.7-50 36.8-67.3 64.6l81.1 46.8c18.4-26.5 49-44 83.7-44z"/><path class="st2" d="M396.1 141.1 315 188c6.3 13.2 9.9 28.1 9.9 43.7.0 53.3-41.2 97-93.5 101v93.7c103.8-4.1 187-89.9 187-194.7C418.4 198.2 411.5 170 396.1 141.1z"/><g><path class="st3" d="M223.5 231.7l-65.8-38c-21 36.4-8.5 82.9 27.8 103.9 12.1 7 24 10.2 38 10.2V231.7z"/></g><g><path class="st3" d="M223.5 231.7l65.8-38c-21-36.4-67.5-48.8-103.9-27.8-12.1 7-20.8 15.7-27.8 27.8l65.9 38z"/></g><g><path class="st3" d="M223.5 231.7v76c42 0 76-34 76-76 0-14-3.2-25.9-10.2-38l-65.8 38z"/></g><g><radialGradient id="SVGID_1_" cx="223.5157" cy="231.6926" r="76.1085" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#969695"/><stop offset="1" style="stop-color:#3F3F3E"/></radialGradient><path class="st4" d="M147.4 231.7c0-42 34.1-76.1 76.1-76.1s76.1 34.1 76.1 76.1-34.1 76.1-76.1 76.1C181.5 307.8 147.4 273.7 147.4 231.7z"/><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="223.5157" y1="155.5859" x2="223.5157" y2="307.7993"><stop offset="0" style="stop-color:#FFFFFF"/><stop offset="1" style="stop-color:#3F3F3E"/></linearGradient><path class="st5" d="M147.4 231.7c0-42 34.1-76.1 76.1-76.1s76.1 34.1 76.1 76.1-34.1 76.1-76.1 76.1C181.5 307.8 147.4 273.7 147.4 231.7z"/><defs><filter id="Adobe_OpacityMaskFilter" filterUnits="userSpaceOnUse" x="177.2" y="172.1" width="92.7" height="59.5"><feColorMatrix type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"/></filter></defs><mask maskUnits="userSpaceOnUse" x="177.2" y="172.1" width="92.7" height="59.5" id="SVGID_3_"><g class="st6"><linearGradient id="SVGID_4_" gradientUnits="userSpaceOnUse" x1="220.0409" y1="123.6788" x2="220.0409" y2="238.3832"><stop offset="0" style="stop-color:#FFFFFF"/><stop offset="1" style="stop-color:#000000"/></linearGradient><rect x="158.4" y="123.7" class="st7" width="123.3" height="114.7"/></g></mask><path class="st8" d="M177.2 201.9c0-16.5 20.7-29.8 46.3-29.8s46.3 13.3 46.3 29.8c0 16.4-20.7 29.8-46.3 29.8s-46.3-13.3-46.3-29.8z"/></g><g><path class="st9" d="M549.7 146c42.6.0 62.7 24.3 62.7 24.3l-17.9 27.8s-17-17.6-42.6-17.6c-30.1.0-49.6 22.7-49.6 50.6.0 27.5 19.8 51.2 50.9 51.2 27.5.0 48-20.8 48-20.8l15.7 28.8s-23.4 26.5-67.2 26.5c-54.1.0-88.6-38.1-88.6-85.4.0-46.4 34.5-85.4 88.6-85.4z"/><path class="st9" d="M697.7 146c49.9.0 89.9 35.5 89.9 85.4.0 50.2-40 85.4-89.6 85.4-49.9.0-89.9-35.2-89.9-85.4.0-49.9 40-85.4 89.6-85.4zM698 282.3c26.3.0 48.3-20.5 48.3-50.9.0-30.1-22.1-50.9-48.3-50.9-26.6.0-48.6 20.8-48.6 50.9.0 30.4 22.1 50.9 48.6 50.9z"/><path class="st9" d="M796.6 149.8h39V178c0 6.1-.6 11.5-.6 11.5h.6c7.4-23.4 26.9-41.9 51.9-41.9 3.8.0 7.3.6 7.3.6v40s-4.2-.6-9.6-.6c-17.3.0-36.8 9.9-44.5 34.2-2.6 8-3.5 16.9-3.5 26.6V313h-40.6V149.8z"/><path class="st9" d="M904.2 105.4h40.7v47H982v32.3h-37.1v63.4c0 26.9 21.1 30.7 32.3 30.7 4.5.0 7.4-.6 7.4-.6v35.5s-4.8 1-12.5 1c-22.7.0-67.9-6.7-67.9-61.4V105.4z"/><path class="st9" d="M1065.5 146c47 0 72.3 34.2 72.3 77.4.0 4.8-1 15.7-1 15.7h-112.6c2.6 28.5 24.6 43.2 49 43.2 26.2.0 47.1-17.9 47.1-17.9l15.7 29.1s-25 23.4-65.6 23.4c-54.1.0-87.7-39-87.7-85.4C982.6 181.2 1016.9 146 1065.5 146zM1096.9 211.3c-.6-22.1-14.4-33.9-32.3-33.9-20.8.0-35.2 12.8-39 33.9h71.3z"/><path class="st9" d="M1236 230.5l52.5-80.6h-46.1l-25.3 44.5c-2.6 4.2-5.4 10.2-5.4 10.2h-.6s-2.9-6.1-5.4-10.2l-25.3-44.5h-46.1l52.5 80.6L1133 313h45.1l28.5-47.4c2.3-3.5 4.5-8.6 4.5-8.6h.6s2.3 5.1 4.5 8.6l28.5 47.4h45.1L1236 230.5z"/><g><path class="st9" d="M1313.8 149.8c9.5.0 17.2 7.7 17.2 17.4.0 9.8-7.6 17.5-17.2 17.5-9.4.0-16.9-7.7-16.9-17.5C1296.8 157.6 1304.4 149.8 1313.8 149.8zm0 32.3c8.2.0 14.4-6.5 14.4-14.9.0-8.3-6.2-14.8-14.4-14.8-8 0-14.1 6.5-14.1 14.8C1299.6 175.6 1305.8 182.1 1313.8 182.1zM1308.1 157.9h6.7c3.3.0 5.6 2.2 5.6 5.6.0 2.8-1.8 4.5-3.5 4.9v.1s.2.2.6 1.1l3.6 7.1h-3l-3.7-7.6h-3.6v7.6h-2.7V157.9zM1314.3 166.9c2 0 3.3-1.3 3.3-3.5.0-2.1-1.3-3.3-3.3-3.3h-3.5v6.8h3.5z"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Cortex</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a id="documentation" class="nav-link" href="/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/blog/" ><span>Blog</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a id="community" class="nav-link" href="https://community.cortex.co.uk/" target="_blank" ><span>Community</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-block pl-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="http://v2022.docs.cortex-ia.com/">v2022 (latest)</a>
	
	<a class="dropdown-item" href="https://community.cortex.co.uk/">v7.2</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.39efe12802d34b814e8e4187eef2da9a.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="50"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Grafana</h1>
<div class="lead">Information about adding a Grafana platform to Innovation, including details about components, supported architectures, prerequisites, installation and configuration instructions.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-5fb5b2a526ef8fd9eb33d06e280b462d">Architecture</a></li>


    
  
    
    
	
<li>2: <a href="#pg-8b1f813d2089e1106a9a85d136a9a16f">Prerequisites</a></li>


    
  
    
    
	
<li>3: <a href="#pg-8590bdb1dc15dd029693ee4f56b58d0e">Install Grafana</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-3e0f6905a3274870e6c528a4dc8c0ab3">Install Grafana</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-9ac1948a5bb1e1fbfc0ac59a2aae12ec">Configure Grafana</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-a0734693798dc61ad5643644b62948c0">Install Grafana Loki</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-2d8cf1bdd8cf0ae749a167a8e8e1cd82">Install Loki</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-d6710f97aa12527849c80fd98cf88444">Configure Loki</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-7f8e6e139863055f06c40b2d3564b2d8">Install Promtail</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-c930e8ae31f7467530e15e5df661d168">Install Promtail</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-0d197756cc28794d8ff66f38c66c474e">Configure Promtail</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-666d1bf739ffd9b748bdcffb9c4c821c">Setup Grafana</a></li>


    
  
    
    
	
<li>7: <a href="#pg-71bb32b5f3e8ebbdccf5e35f678a6420">Try it Out</a></li>


    
  
    
    
	
<li>8: <a href="#pg-d36d5652578d21bcda9206b5400f43cb">Advanced Setup</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>8.1: <a href="#pg-ac6b22b516ced12a3a2b7e6dd681a138">Create Self-Signed Certificates</a></li>


    
  
    
    
	
<li>8.2: <a href="#pg-2fd180e7b945d096940590807e716e77">Port Requirements for the Web Application Server</a></li>


    
  
    
    
	
<li>8.3: <a href="#pg-d01c6456d2bf3ab4802e0e9bc8b3b049">SSL Best Practices</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      

<div class="pageinfo pageinfo-primary">
<p>For instructions on how to set up Grafana and Grafana Loki in the cloud see <a href="/docs/getting-started/cloud/add-observability-to-innovation/grafana/">Grafana Cloud</a>.</p>

</div>


</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-5fb5b2a526ef8fd9eb33d06e280b462d">1 - Architecture</h1>
    <div class="lead">Information about the recommended architecture for a Grafana platform installation.</div>
	<h1 id="architecture">Architecture</h1>
<h2 id="components">Components</h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Required/Optional</th>
<th>Server Role</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://grafana.com/grafana/">Grafana</a></td>
<td>Web application that provides querying and visualisation of data in the form of dashboards.</td>
<td>Required</td>
<td>Web Application Server</td>
</tr>
<tr>
<td><a href="https://grafana.com/oss/loki/">Grafana Loki</a></td>
<td>Log aggregation system designed to store and query logs from applications and infrastructure.</td>
<td>Required</td>
<td>Web Application Server</td>
</tr>
<tr>
<td><a href="https://www.iis.net/overview">Microsoft Internet Information Services (IIS)</a></td>
<td>Web server used as a reverse proxy for Grafana Loki.</td>
<td>Required</td>
<td>Web Application Server</td>
</tr>
<tr>
<td><a href="https://grafana.com/docs/loki/latest/clients/promtail/">Promtail</a></td>
<td>An agent which ships the contents of local logs to a Grafana Loki instance. It should be deployed to every machine that has a Microsoft Service Fabric node used by Innovation.</td>
<td>Required</td>
<td>Application Server</td>
</tr>
</tbody>
</table>
<h2 id="recommended-architecture">Recommended Architecture</h2>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For production systems it is recommended to <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites/#option-1-install-on-new-hardware">install on new hardware</a>. However, if additional hardware is not available, you can <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites/#option-2-install-on-existing-hardware">install on existing hardware</a>.

</div>

<p>The following architecture requires 1 + 1..n servers:</p>
<ul>
<li>1 x Web Application Server which contains Grafana, Grafana Loki and Microsoft IIS.</li>
<li>1..n x Application Servers.</li>
</ul>

<figure>
    <img src=" /images/Grafana%20Platform%20Architecture%20Diagram%20-%20On-Premise.svg "/> 
</figure>

<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites">Prerequisites</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8b1f813d2089e1106a9a85d136a9a16f">2 - Prerequisites</h1>
    <div class="lead">Information about the prerequisites required on each server type for installation.</div>
	<h1 id="prerequisites">Prerequisites</h1>
<p>The prerequisites required for each server role (as described in <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/architecture">Architecture</a>) are laid out in this guide. These must be considered before undertaking the installation.</p>
<h2 id="hardware-requirements">Hardware Requirements</h2>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For production systems it is recommended to <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites/#option-1-install-on-new-hardware">install on new hardware</a>. However, if additional hardware is not available, you can <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites/#option-2-install-on-existing-hardware">install on existing hardware</a>.

</div>

<h3 id="option-1-install-on-new-hardware">Option 1: Install on New Hardware</h3>
<p>The following hardware requirements are recommended for production systems:</p>
<table>
<thead>
<tr>
<th>Server Role</th>
<th>Servers Required</th>
<th>CPU Cores (&gt; 2GHz)</th>
<th>RAM (GB)</th>
<th>Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web Application Server</td>
<td>1</td>
<td>4+ <em>Recommended</em><br>2 <em>Minimum</em></td>
<td>16+ <em>Recommended</em><br>8 <em>Minimum</em></td>
<td>50+ (SSD) <em>Recommended</em><br>40 (HDD) <em>Minimum</em><br>5+ free on installation drive</td>
</tr>
</tbody>
</table>
<h3 id="option-2-install-on-existing-hardware">Option 2: Install on Existing Hardware</h3>
<p>If additional hardware is not available, it is possible to install to the same Web Application server that hosts Cortex Gateway.</p>
<p>The table below specifies additional resources that are recommended to be added to the existing Web Application server:</p>
<table>
<thead>
<tr>
<th>Server Role</th>
<th>Additional CPU Cores (&gt; 2GHz)</th>
<th>Additional RAM (GB)</th>
<th>Additional Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web Application Server<br>(Shared with Cortex Gateway)</td>
<td>4+ <em>Recommended</em><br>2 <em>Minimum</em></td>
<td>12+ <em>Recommended</em><br>6 <em>Minimum</em></td>
<td>10+ <em>Recommended</em><br>5 <em>Minimum</em></td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The application servers (as described in <a href="/docs/getting-started/on-premise/install-innovation-only/multiple-server-with-ha/architecture">Architecture</a>) to which Promtail will be added have already been installed as part of the Innovation install process and do not require any hardware modifications for the observability platform installation.

</div>

<h2 id="software-requirements">Software Requirements</h2>
<table>
<thead>
<tr>
<th>Server Role</th>
<th>Windows Server<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></th>
<th>IIS<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></th>
<th>Other Software</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web Application Server</td>
<td><a href="https://www.microsoft.com/en-US/evalcenter/evaluate-windows-server-2019?filetype=ISO">2019 (x64)</a> <em>Recommended</em><br><a href="https://www.microsoft.com/en-US/evalcenter/evaluate-windows-server-2016?filetype=ISO">2016 (x64)</a></td>
<td>10.0.17763<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup><br>10.0.14393<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup><br>IIS Basic Authentication<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup><br><a href="https://www.iis.net/downloads/microsoft/url-rewrite">URL Rewrite module 2.1</a></td>
<td><a href="https://grafana.com/grafana/download/8.5.4?pg=get&amp;plcmt=selfmanaged-box1-cta1&amp;platform=windows">Grafana 8.5.4</a> <em>Enterprise Edition</em><br><a href="https://github.com/grafana/loki/releases/download/v2.5.0/loki-windows-amd64.exe.zip">Grafana Loki 2.5.0</a></td>
</tr>
<tr>
<td>Application Server</td>
<td><a href="https://www.microsoft.com/en-US/evalcenter/evaluate-windows-server-2019?filetype=ISO">2019 (x64)</a> <em>Recommended</em><br><a href="https://www.microsoft.com/en-US/evalcenter/evaluate-windows-server-2016?filetype=ISO">2016 (x64)</a></td>
<td></td>
<td><a href="https://github.com/grafana/loki/releases/download/v2.5.0/promtail-windows-amd64.exe.zip">Promtail 2.5.0</a></td>
</tr>
</tbody>
</table>
<h2 id="domain-requirements">Domain Requirements</h2>
<p>All servers must be on the same domain and cannot be domain controllers.</p>
<h2 id="web-browser-requirements">Web Browser Requirements</h2>
<p>Grafana supports the latest versions of the following browsers:</p>
<ul>
<li>Chrome/Chromium</li>
<li>Firefox</li>
<li>Safari</li>
<li>Microsoft Edge</li>
</ul>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Always enable JavaScript in your browser. Running Grafana without JavaScript enabled in the browser is not supported.

</div>

<h2 id="additional-web-application-server-requirements">Additional Web Application Server Requirements</h2>
<h3 id="security-requirements">Security Requirements</h3>
<h4 id="installation-user">Installation User</h4>
<p>A domain user which is a member of the Local Administrators group on the Web Application Server must be available to perform the installation.</p>
<h4 id="port-requirements">Port Requirements</h4>
<p>The observability platform requires a range of <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/advanced/port-requirements">firewall ports to be opened</a> on the Web Application Server.</p>
<h4 id="certificate-requirements">Certificate Requirements</h4>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For production systems, it is recommended that X.509 SSL certificates are obtained from a Certificate Authority and used for installation. For non-production systems, self-signed certificates may be used. Details on how to create a self-signed certificate can be found at <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/advanced/self-signed-certificates">Create Self-Signed Certificates</a>.

</div>

<p>An X.509 SSL certificate (standard, wildcard or self-signed) should be used to secure communication between:</p>
<ul>
<li>Promtail on the Application Servers and the reverse proxy configured for Grafana Loki on the Web Application Server.</li>
<li>Grafana end users and the Grafana Web Application on the Web Application Server.</li>
</ul>
<p>The wildcard certificate used for installing Innovation can be used if it is available in the .PEM file format, otherwise a new certificate can be obtained from a Certificate Authority, such as <a href="https://letsencrypt.org/">Let’s Encrypt</a>, and must meet the following requirements:</p>
<ul>
<li>Subject field must be in one of the following formats, depending on the certificate type:
<ul>
<li>Standard certificates must use the standard format (e.g. <code>CN=host.domain.com</code>).</li>
<li>Wildcard certificates must use the wildcard format, pertaining to the domain of the Web Application Server (e.g. <code>CN=*.domain.com</code>).</li>
</ul>
</li>
<li>Subject alternative names must include any additional host names that should be able to be used to access the Grafana Web Application.</li>
<li>Certificate file must be in a .PFX file format, with a known password.</li>
<li>Certificate file must also be available in a .PEM file format.</li>
<li>Certificate file must contain the full chain of certificates.</li>
<li>Certificate file must include the private key.</li>
</ul>
<p>The files should be placed in a known location on the Web Application Server. This location will be required when <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-grafana/configure-grafana/#configure-https">configuring Grafana to use HTTPS</a>.</p>
<p>More information about importing the certificate is given during <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#install-certificate">installation</a>.</p>
<h4 id="tls-requirements">TLS Requirements</h4>
<p>A set of non-compulsory security measures is recommended to be applied to the Web Application Server to prevent attacks that exploit known industry security vulnerabilities. This includes disabling all versions of SSL and TLS apart from TLS 1.2, and disabling all cipher suites apart from the following:</p>
<ul>
<li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li>
<li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li>
</ul>
<p>See <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/advanced/ssl-best-practices">SSL Best Practices</a> for a full list of the recommended security changes to be applied.</p>
<h5 id="apply-recommended-security-measures">Apply Recommended Security Measures</h5>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Warning</h4>

    Disabling specific TLS versions or specific Cipher Suites can have impact on other applications as well as their communication capabilities with third party systems and services. All parties communicating together must support a shared protocol version and cipher suite, otherwise they will not be able to establish a secure communication link between each other.

</div>

<p>Apply the settings by following these instructions:</p>
<ol>
<li>
<p>Copy from one of the application servers the <code>Cortex.Innovation.Install.SSLBestPractices.ps1</code> file extracted during the <a href="/docs/getting-started/on-premise/install-innovation-only/multiple-server-with-ha/install-application-and-loadbalancer-servers/#make-installation-artefacts-available">Make Installation Artefacts Available</a> step into a suitable location on the Web Application Server.</p>
</li>
<li>
<p>Open a Windows PowerShell (x64) window as administrator.</p>
</li>
<li>
<p>Change the location to the folder where the <code>Cortex.Innovation.Install.SSLBestPractices.ps1</code> file was copied to using the following command, modifying the path as necessary:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#204a87">cd </span><span style="color:#4e9a06">&#34;C:\Install&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Run the <code>Cortex.Innovation.Install.SSLBestPractices.ps1</code> script using the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.\</span><span style="color:#000">Cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Innovation</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Install</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SSLBestPractices</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ps1</span>
</span></span></code></pre></div></li>
<li>
<p>To use all the recommended settings click <code>Apply all</code> to the first prompt.</p>
<p>To selectively apply each setting select <code>Choose which to apply</code>. Each change will then be prompted with a Yes/No confirmation before applying.</p>
</li>
<li>
<p>Restart the machine when the script asks.</p>
</li>
</ol>
<h2 id="additional-application-server-requirements">Additional Application Server Requirements</h2>
<p>These requirements apply to each of the Application Servers.</p>
<h3 id="security-requirements-1">Security Requirements</h3>
<h4 id="installation-user-1">Installation User</h4>
<p>A domain user which is a member of the Local Administrators group on all Application Servers must be available to perform the installation.</p>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-grafana/">Install Grafana</a></li>
</ol>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Windows Server Standard and Datacenter editions are supported. Filesystem <strong>must be NTFS</strong> and networking <strong>must use IPv4</strong>. Linux is not supported, but may be in the future.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>IIS is supported; other web servers, including IIS Express are not supported.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Ships as a windows role within Windows Server 2019.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Ships as a windows role within Windows Server 2016.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Installed during the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#install-iis-basic-authentication">Install IIS Basic Authentication</a> configuration steps.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8590bdb1dc15dd029693ee4f56b58d0e">3 - Install Grafana</h1>
    <div class="lead">Information about installing and configuring Grafana on the Web Application Server.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-3e0f6905a3274870e6c528a4dc8c0ab3">3.1 - Install Grafana</h1>
    <div class="lead">Information about installing Grafana on the Web Application Server.</div>
	<h1 id="install-grafana">Install Grafana</h1>
<p>This guide describes how to install Grafana on the Web Application Server. Please ensure that the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites">Prerequisites</a> have been completed before starting this installation.</p>
<h2 id="install-grafana-1">Install Grafana</h2>
<ol>
<li>Download the <a href="https://grafana.com/grafana/download/8.5.4?pg=get&amp;plcmt=selfmanaged-box1-cta1&amp;platform=windows">Grafana 8.5.4</a> Windows installer.</li>
<li>Run the installer and install Grafana to a suitable location.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-grafana/configure-grafana">Configure Grafana</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9ac1948a5bb1e1fbfc0ac59a2aae12ec">3.2 - Configure Grafana</h1>
    <div class="lead">Information about configuring Grafana on the Web Application Server.</div>
	<h1 id="configure-grafana">Configure Grafana</h1>
<p>This guide describes how to configure Grafana on the Web Application Server.</p>
<h2 id="log-in-and-change-the-password">Log-in and Change the Password</h2>
<p>It is required that on the first log in into Grafana, a new password for the admin user is set up.
The password should be different from the default one.</p>
<ol>
<li>On the Web Application Server open a web browser.</li>
<li>Browse to <code>http://localhost:3000/</code>.</li>
<li>On the login page, enter <code>admin</code> for the username and password.</li>
<li>Click Log in.</li>
<li>Set a new password for the admin user when prompted to do so.</li>
</ol>
<h2 id="configure-https">Configure HTTPS</h2>
<p>By default Grafana allows access over the unsecure HTTP protocol. This needs to be modified to allow access only over the secure HTTPS protocol.</p>
<ol>
<li>
<p>Locate <code>sample.ini</code> file in the <code>grafana\conf</code> subfolder in the location Grafana was installed to; by default <code>C:\Program Files\GrafanaLabs\grafana\conf\sample.ini</code>.</p>
</li>
<li>
<p>Copy <code>sample.ini</code> and paste it in the same location renaming it to <code>custom.ini</code>.</p>
</li>
<li>
<p>Run a text editor in administrator mode.</p>
</li>
<li>
<p>In the text editor open the <code>custom.ini</code> Grafana configuration file.</p>
</li>
<li>
<p>In the <code>server</code> section uncomment the <code>protocol</code> option and set it to HTTPS, e.g.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Protocol (http, https, h2, socket)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">protocol = https</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>In the <code>server</code> section uncomment the <code>cert_file</code> and <code>cert_key</code> options and set them to the certificate <code>.pem</code> and <code>.key</code> filenames and path saved to during the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites#certificate-requirements">Certificate Requirements</a> step e.g.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># https certs &amp; key file</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cert_file = C:\certificates\certificate.pem</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">cert_key = C:\certificates\certificate.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>Save the file.</p>
</li>
<li>
<p>Open the Services app.</p>
</li>
<li>
<p>Restart the Grafana service.</p>
</li>
</ol>
<h2 id="verify-that-https-works">Verify That HTTPS Works</h2>
<p>It is important to verify that Grafana is only accessible through HTTPS.</p>
<ol>
<li>On the Web Application Server open a web browser.</li>
<li>Browse to <code>http://localhost:3000/</code>.</li>
<li>Browser should not be able to make a connection to Grafana and a default error page should be displayed.</li>
<li>Browse to <code>https://localhost:3000/</code>.</li>
<li>On the login page, enter <code>admin</code> as the username and the corresponding password.</li>
<li>Click Log in.</li>
<li>You should have successfully logged into Grafana.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/">Install Grafana Loki</a></li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a0734693798dc61ad5643644b62948c0">4 - Install Grafana Loki</h1>
    <div class="lead">Information about installing and configuring Grafana Loki on the Web Application Server.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-2d8cf1bdd8cf0ae749a167a8e8e1cd82">4.1 - Install Loki</h1>
    <div class="lead">Information about installing Grafana Loki on the Web Application Server.</div>
	<h1 id="install-loki">Install Loki</h1>
<p>This guide describes how to install Grafana Loki on the Web Application Server. Please ensure that the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites">Prerequisites</a> have been completed before starting this installation.</p>
<h2 id="install-grafana-loki">Install Grafana Loki</h2>
<ol>
<li>Download <a href="https://github.com/grafana/loki/releases/download/v2.5.0/loki-windows-amd64.exe.zip">Grafana Loki 2.5.0</a> archive.</li>
<li>Extract content of the downloaded archive to a suitable location, e.g. <code>C:\Loki</code>.</li>
<li>Download the <a href="https://github.com/CortexIntelligentAutomation/observability/releases/download/v1.0.0/Grafana.Loki.Install.zip">Grafana Loki Install.zip</a> archive and extract its contents alongside the previously extracted Grafana Loki <code>loki-windows-amd64.exe</code>.
This archive contains the <code>loki-local-config.yaml</code> configuration file, <a href="https://nssm.cc/">NSSM</a> (the Non-Sucking Service Manager program) and PowerShell scripts to help manage Grafana Loki as a Windows service.</li>
<li>Run Windows PowerShell as Administrator.</li>
<li>Change the location to where all the files were extracted to.</li>
<li>Execute the <code>.\Install-Loki.ps1</code> command to install the downloaded Grafana Loki <code>loki-windows-amd64.exe</code> as a service.</li>
<li>Execute the <code>.\Start-Loki.ps1</code> command to start the Grafana Loki service.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki">Configure Loki</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d6710f97aa12527849c80fd98cf88444">4.2 - Configure Loki</h1>
    <div class="lead">Information about configuring Grafana Loki on the Web Application Server.</div>
	<h1 id="configure-loki">Configure Loki</h1>
<p>This guide describes how to configure Grafana Loki on the Web Application Server.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For security reasons, Grafana Loki should be run behind an encrypted and authenticated reverse proxy as it does not provide these features by itself.

</div>

<h2 id="install-certificate">Install Certificate</h2>
<p>IIS requires the X.509 SSL certificate, obtained in the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites#certificate-requirements">prerequisites</a>, to be installed on the Web Application Server.</p>
<p>You can import the certificate by right clicking the certificate file, selecting <code>Install Certificate</code> and following the wizard. When prompted, ensure you import it into the <code>Local Machine</code> store and not <code>Current User</code>.</p>
<p>To verify the certificate is imported:</p>
<ol>
<li>Click the Windows button (<code>Start</code>)</li>
<li>Type <code>certlm.msc</code> and press <code>Enter</code> to open the Certificate Manager dialog</li>
<li>Expand <code>Personal</code> and select <code>Certificates</code></li>
<li>You should see your certificate in this store</li>
</ol>
<h2 id="setup-reverse-proxy-with-iis">Setup Reverse Proxy with IIS</h2>
<p>All of the steps must be carried out on the Web Application Server.</p>
<h3 id="install-iis-basic-authentication">Install IIS Basic Authentication</h3>
<ol>
<li>Run <em>Server Manager</em>.</li>
<li>Expand the <em>Manage</em> menu and select <em>Add Roles and Features</em>.</li>
<li>In the left-hand menu, select <em>Server Selection</em>.</li>
<li>Select the name of the Web Application Server, click <em>Next</em>.</li>
<li>On the <em>Server Roles</em> page, in the <em>Roles</em> tree, expand <em>Web Server (IIS)</em> &ndash;&gt; <em>Web Server</em> &ndash;&gt; <em>Security</em>.</li>
<li>Select <em>Basic Authentication</em>, click <em>Next</em>.</li>
<li>Click <em>Next</em> to get to the <em>Confirm installation selections</em> page.</li>
<li>Click <em>Install</em>.</li>
<li>Click <em>Close</em> on the <em>Results</em> page.</li>
</ol>
<h3 id="install-iis-url-rewrite-module">Install IIS URL Rewrite Module</h3>
<ol>
<li>Download the <a href="https://www.iis.net/downloads/microsoft/url-rewrite">URL Rewrite module 2.1</a></li>
<li>Run the downloaded installer.</li>
<li>When prompted by the Web Platform Installer, click <em>Install</em>.</li>
<li>On the <em>Prerequisites</em> page click <em>I Accept</em> to agree to the license terms for the module.</li>
<li>Once the install has completed, click <em>Finish</em>.</li>
<li>Click <em>Exit</em> to close the Web Platform Installer.</li>
</ol>
<h3 id="install-application-request-routing">Install Application Request Routing</h3>
<ol>
<li>Download <a href="https://www.iis.net/downloads/microsoft/application-request-routing">Application Request Routing 3.0</a></li>
<li>Run the downloaded installer.</li>
<li>When prompted by the Web Platform Installer, click <em>Install</em>.</li>
<li>On the <em>Prerequisites</em> page click <em>I Accept</em> to agree to the license terms for the module.</li>
<li>Once the install has completed, click <em>Finish</em>.</li>
<li>Click <em>Exit</em> to close the Web Platform Installer.</li>
</ol>
<h3 id="set-up-reverse-proxy">Set Up Reverse Proxy</h3>
<p>To set up a reverse proxy, carry out the following configuration.</p>
<h4 id="add-a-new-website">Add a New Website</h4>
<ol>
<li>Run IIS Manager.</li>
<li>In the <em>Connection</em> pane, expand the server.</li>
<li>Right-click on <em>Sites</em> and select <em>Add Website&hellip;</em> from the menu.</li>
<li>In the <em>Add Website</em> window:
<ul>
<li>Provide the site name, e.g. <code>Grafana Loki</code>.</li>
<li>Set the <em>Physical path</em> to the location where the site will be stored and ensure that the path exists, e.g. <code>C:\inetpub\wwwroot\Grafana Loki</code>.</li>
<li>For <em>Binding</em> set:
<ul>
<li><em>Type</em>: <code>https</code></li>
<li><em>IP address</em>: <code>All unassigned</code></li>
<li><em>Port</em>: <code>2100</code></li>
</ul>
</li>
<li><em>Host name</em>: The fully qualified domain name of the Web Application Server. This must match one of the Subject Alternative Names in the SSL certificate selected in the next step.</li>
<li><em>SSL certificate</em>: Select the certificate created as part of the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites#certificate-requirements">Certificate Requirements</a> instructions.</li>
<li>Click <em>OK</em> to add the website.</li>
</ul>
</li>
</ol>
<h4 id="enable-basic-authentication">Enable Basic Authentication</h4>
<ol>
<li>In the <em>Connection</em> pane, browse to <em>Sites</em>.</li>
<li>Select the newly created website.</li>
<li>Double-click on the <em>Authentication</em> icon.</li>
<li>Disable <em>Anonymous Authentication</em>.</li>
<li>Enable <em>Basic Authentication</em>.</li>
</ol>
<h2 id="configure-url-rewrite-rule">Configure URL Rewrite Rule</h2>
<ol>
<li>In the <em>Connection</em> pane, browse to <em>Sites</em>.</li>
<li>Select the newly created website.</li>
<li>Double-click on the <em>URL Rewrite</em> icon.</li>
<li>In the <em>Actions</em> pane, click <em>Add Rule(s)&hellip;</em>.</li>
<li>Select <em>Reverse Proxy</em> from the <em>Inbound and Outbound Rules</em> section.</li>
<li>Click <em>OK</em>.</li>
<li>If prompted to <em>Add Reverse Proxy Rules</em>, click <em>OK</em> to enable proxy functionality.</li>
<li>In the <em>Inbound Rules</em> section enter <code>localhost:3100</code> as the server name.</li>
<li>Ensure that <em>Enable SSL Offloading</em> is checked.</li>
<li>Click <em>OK</em>.</li>
</ol>
<h4 id="restart-the-website">Restart the Website</h4>
<ol>
<li>In the <em>Connection</em> pane, browse to <em>Sites</em>.</li>
<li>Select the newly created website.</li>
<li>In the <em>Manage Website</em> pane, click <em>Restart</em>.</li>
</ol>
<h4 id="create-loki-user">Create Loki User</h4>
<ol>
<li>
<p>Run Windows PowerShell as Administrator.</p>
</li>
<li>
<p>Execute the following command to create a new local user on the Web Application Server:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Powershell" data-lang="Powershell"><span style="display:flex;"><span><span style="color:#204a87">New-LocalUser</span> <span style="color:#4e9a06">&#34;&lt;username&gt;&#34;</span> <span style="color:#000">-Password</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">ConvertTo-SecureString</span> <span style="color:#4e9a06">&#34;&lt;password&gt;&#34;</span> <span style="color:#000">-AsPlainText</span> <span style="color:#000">-force</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">-FullName</span> <span style="color:#4e9a06">&#34;&lt;name&gt;&#34;</span> <span style="color:#000">-Description</span> <span style="color:#4e9a06">&#34;&lt;description&gt;&#34;</span> <span style="color:#a40000">–</span><span style="color:#000">PasswordNeverExpires</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>username</td>
<td>The username of the user to be created.</td>
</tr>
<tr>
<td>password</td>
<td>The password for the user account.</td>
</tr>
<tr>
<td>name</td>
<td>The full name for the user account.</td>
</tr>
<tr>
<td>description</td>
<td>The description of the user account.</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-promtail/">Install Promtail</a></li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7f8e6e139863055f06c40b2d3564b2d8">5 - Install Promtail</h1>
    <div class="lead">Information about installing and configuring Promtail on the Application Server(s).</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c930e8ae31f7467530e15e5df661d168">5.1 - Install Promtail</h1>
    <div class="lead">Information about installing Promtail on the Application Server(s).</div>
	<h1 id="install-promtail">Install Promtail</h1>
<p>This guide describes how to install Promtail on the Application Server(s). Please ensure that the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites">Prerequisites</a> have been completed before starting this installation.</p>
<h2 id="install-promtail-1">Install Promtail</h2>
<ol>
<li>Download <a href="https://github.com/grafana/loki/releases/download/v2.5.0/promtail-windows-amd64.exe.zip">Promtail 2.5.0</a> archive.</li>
<li>Extract content of the downloaded archive to a suitable location, e.g. <code>C:\Promtail</code>.</li>
<li>Download the <a href="https://github.com/CortexIntelligentAutomation/observability/releases/download/v1.0.0/Promtail.Install.zip">Promtail Install.zip</a> archive and extract its contents alongside the previously extracted Promtail <code>promtail-windows-amd64.exe</code>.
This archive contains the <code>promtail-local-config.yaml</code> configuration file, <a href="https://nssm.cc/">NSSM</a> (the Non-Sucking Service Manager program) and PowerShell scripts to help manage Promtail as a Windows service.</li>
<li>Run Windows PowerShell as Administrator</li>
<li>Change the location to where all the files were extracted to.</li>
<li>Execute the <code>.\Install-Promtail.ps1</code> command to install the downloaded <code>promtail-windows-amd64.exe</code> as a service.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-promtail/configure-promtail">Configure Promtail</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d197756cc28794d8ff66f38c66c474e">5.2 - Configure Promtail</h1>
    <div class="lead">Information about configuring Promtail on the Application Server(s).</div>
	<h1 id="configure-promtail">Configure Promtail</h1>
<p>This guide describes how to configure Promtail on the Application Server(s).</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    These steps must be performed for every Promtail installation in the cluster.

</div>

<h2 id="install-certificate">Install Certificate</h2>
<p>If a self-signed certificate was obtained in the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/prerequisites#certificate-requirements">prerequisites</a>, the CA certificate used to create this certificate must be imported on each Application Server. Otherwise, Promtail will not be able to establish communication with Grafana Loki.</p>
<p>To import the CA certificate:</p>
<ol>
<li>Copy the <code>cortexCA.pfx</code> CA certificate created during the <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/advanced/self-signed-certificates/#generate-the-root-ca-certificate">root CA certificate generation</a> steps into a suitable location on the Application Server.</li>
<li>Double click on the <code>cortexCA.pfx</code> file to import the certificate into the Windows Certificate Store.</li>
<li>Select <code>Local Machine</code> then click <code>Next</code>.</li>
<li>Click <code>Next</code>.</li>
<li>Enter the Export Password which the certificate was generated with then click <code>Next</code>.</li>
<li>Select <code>Place all certificates in the following store</code>.</li>
<li>Click <code>Browse…</code>.</li>
<li>Select <code>Trusted Root Certification Authorities</code>, click <code>OK</code> then click <code>Next</code>.</li>
<li>Click <code>Finish</code>.</li>
</ol>
<h2 id="configure-promtail-1">Configure Promtail</h2>
<h3 id="set-client-url-for-grafana-loki">Set Client URL for Grafana Loki</h3>
<ol>
<li>
<p>Open the <code>promtail-local-config.yaml</code> configuration file, which is located in the folder alongside the <code>promtail-windows-amd64.exe</code> file.</p>
</li>
<li>
<p>Set the Grafana Loki <code>URL</code> in the <code>clients</code> section.</p>
<p>The following template has been provided for convenience:
<code>https://&lt;username&gt;:&lt;password&gt;@&lt;loki host address&gt;:&lt;loki reverse proxy port&gt;/loki/api/v1/push</code></p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>username</td>
<td>The username of the user created during <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#create-loki-user">Create Loki User</a> steps.</td>
</tr>
<tr>
<td>password</td>
<td>The password which was set for the user  during <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#create-loki-user">Create Loki User</a> steps.</td>
</tr>
<tr>
<td>loki host address</td>
<td>The host address of the machine where the Grafana Loki reverse proxy was configured during <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#add-a-new-website">Add a New Website</a> steps . This must match the configured host name.</td>
</tr>
<tr>
<td>loki reverse proxy port</td>
<td>The port of the Grafana Loki reverse proxy configured during <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/configure-loki/#add-a-new-website">Add a New Website</a> steps. Usually 2100.</td>
</tr>
</tbody>
</table>
<p>A correct URL should be similar to <code>https://username:password@hostaddress:2100/loki/api/v1/push</code>.</p>
</li>
<li>
<p>Save the file.</p>
</li>
</ol>
<h3 id="set-the-positionsyaml-file-path">Set the positions.yaml File Path</h3>
<ol>
<li>Open the <code>promtail-local-config.yaml</code> configuration file, which is located in the folder alongside the <code>promtail-windows-amd64.exe</code> file.</li>
<li>Set the <code>filename</code> in the <code>positions</code> section to the location where you want the <code>positions.yaml</code> file to be created on Promtail startup.</li>
<li>Create all the folders of the path specified in the previous step.</li>
<li>Save the file.</li>
</ol>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If the specified path to the folder for the <code>positions.yaml</code> file doesn&rsquo;t exists, the file will not get created on Promtail startup.

</div>

<h3 id="set-the-path-to-the-cortex-api-gateway-service-log-files">Set the Path to the Cortex API Gateway Service Log Files</h3>
<ol>
<li>Open the <code>promtail-local-config.yaml</code> configuration file, which is located in the folder alongside the <code>promtail-windows-amd64.exe</code> file.</li>
<li>Set the <code>__path__</code> in the <code>static_configs</code> &gt; <code>targets</code> &gt; <code>labels</code> section to the path of the <code>Logs</code> folder specified in the <code>appSettings.json</code> file during installation of the Cortex API Gateway Service, e.g. <code>&quot;C:/ProgramData/Cortex/Cortex API Gateway Service/Logs/*.json&quot;</code>.</li>
<li>Save the file.</li>
</ol>
<h3 id="start-promtail">Start Promtail</h3>
<ol>
<li>Run Windows PowerShell as Administrator.</li>
<li>Change the location to the folder where the <code>promtail-windows-amd64.exe</code> file is located.</li>
<li>Execute the <code>.\Start-Promtail.ps1</code> command to start the Promtail Windows service.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/setup-grafana">Setup Grafana</a></li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-666d1bf739ffd9b748bdcffb9c4c821c">6 - Setup Grafana</h1>
    <div class="lead">Information about setting up Grafana to communicate with the installed Grafana Loki as well as importing and configuring the default set of dashboards.</div>
	<h1 id="setup-grafana">Setup Grafana</h1>
<p>This guide describes where to get the default Cortex Innovation Dashboards from and how to import them for use in Grafana.</p>
<p>Please ensure that the Installations for <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-grafana/">Grafana</a> and <a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/install-loki/">Loki</a> have been completed before starting this section.</p>
<h2 id="configure-loki-data-source-in-grafana">Configure Loki Data Source in Grafana</h2>
<ol>
<li>
<p>Log in to your configured Grafana instance with a user that has the <em>admin</em> role.</p>
</li>
<li>
<p>In Grafana, go to <em>Configuration</em> &gt; <em>Data Sources</em> via the cog icon on the left sidebar.</p>
</li>
<li>
<p>Click the big <em>Add data source</em> button.</p>
</li>
<li>
<p>Choose <em>Loki</em> from the list.</p>
</li>
<li>
<p>Configure the data source as follows:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>The name of the data source to use in Grafana</td>
<td><code>Cortex Loki</code></td>
</tr>
<tr>
<td>URL</td>
<td>The address of your Grafana Loki Server</td>
<td><code>http://localhost:3100</code></td>
</tr>
<tr>
<td>Timeout</td>
<td>The HTTP request timeout in seconds set to the same value as configured in the Grafana Loki <code>loki-local-config.yaml</code> configuration file located alongside the Grafana Loki <code>loki-windows-amd64.exe</code> file.</td>
<td><code>600</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <em>Save and Test</em>.</p>
</li>
<li>
<p><em>Data source connected and labels found.</em> message should be displayed above the <em>Save and Test</em></p>
</li>
</ol>
<h2 id="download-the-cortex-innovation-default-dashboards">Download the Cortex Innovation Default Dashboards</h2>
<ol>
<li>Download <a href="https://github.com/CortexIntelligentAutomation/observability/releases/download/v1.0.0/Grafana.Dashboards.zip">Grafana.Dashboards.zip</a> archive containing the Cortex Innovation default dashboards.</li>
<li>Extract the content of the downloaded archive to a suitable location.</li>
</ol>
<h2 id="create-folder-for-dashboards">Create Folder for Dashboards</h2>
<ol>
<li>Log in to your configured Grafana with a user that has the <em>Admin</em> role.</li>
<li>To create a folder, click the + icon in the side menu, and then click <em>Folder</em>.</li>
<li>Enter a folder name, e.g. <code>Cortex</code>.</li>
<li>Click <em>Create</em>.</li>
</ol>
<h2 id="import-dashboards">Import Dashboards</h2>
<ol>
<li>
<p>Log in to your configured Grafana with a user that has the <em>Admin</em> role.</p>
</li>
<li>
<p>To import a dashboard, click the + icon in the side menu, and then click <em>Import</em>.</p>
</li>
<li>
<p>Click the <em>Upload JSON file</em> button.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    This button is broken in the Grafana 8.5.3 version and it may be necessary to use your keyboard’s <em>tab</em> button until the <em>Upload JSON file</em> button is highlighted and press <em>Enter</em>.

</div>

</li>
<li>
<p>Locate the <code>Flow Execution Requests.json</code> file extracted from the downloaded <code>Grafana.Dashboards.zip</code>.</p>
</li>
<li>
<p>Select the file and click <em>Open</em>.</p>
</li>
<li>
<p>Select the folder in Grafana you wish the dashboard to be saved in, e.g. <em>Cortex</em>.</p>
</li>
<li>
<p>Select your configured Loki data source from the dropdown menu.</p>
</li>
<li>
<p>Click <em>Import</em>.</p>
</li>
<li>
<p>Repeat steps 2 - 8 for the <code>Platform Health.json</code> file.</p>
</li>
</ol>
<h2 id="configure-data-sources">Configure Data Sources</h2>
<p>It is necessary to update the Custom Filter inside the dashboards to use the correct data source.</p>
<p>To do this, follow these steps for all default Cortex Innovation dashboards imported:</p>
<ol>
<li>Log in to your configured Grafana with a user that has the <em>Admin</em> role.</li>
<li>To open a dashboard:
<ol>
<li>Click the Dashboards icon <img src="/images/DashboardsIcon.png" alt="Dashboards Icon" title="Dashboards Icon"> in the side menu, and then click <em>Browse</em>.</li>
<li>Click the folder name that the dashboards were imported to.</li>
<li>Click the <em>Flow Execution Requests</em> dashboard to open it.</li>
</ol>
</li>
<li>Open the Dashboard Settings menu via the cog icon in the top right-hand side of the dashboard.</li>
<li>Click <em>Variables</em> on the left-hand side of the page.</li>
<li>Click <em>Custom Filter</em> at the bottom of the <em>Variables</em> list.</li>
<li>Select your configured Loki data source in the <em>Options</em> &gt; <em>Data source</em> drop-down menu.</li>
<li>Click <em>Update</em>.</li>
<li>Click the back button on the top left corner of the page to go back to the dashboard.</li>
<li>Click the + icon next to the Custom Filter to confirm that a list of available filter options is visible.</li>
<li>Repeat steps 2 - 9 for the <em>Platform Health</em> dashboard.</li>
</ol>
<h2 id="next-steps">Next Steps?</h2>
<ol>
<li><a href="/docs/getting-started/on-premise/add-observability-to-innovation/grafana/try-it-out">Try it Out</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-71bb32b5f3e8ebbdccf5e35f678a6420">7 - Try it Out</h1>
    <div class="lead">Information about trying out Grafana Observability Dashboards for the first time.</div>
	<h1 id="try-it-out">Try it Out</h1>
<h2 id="check-dashboards-are-displaying-data">Check Dashboards are Displaying Data</h2>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    This test uses the test flow published as part of testing the Innovation installation. See <a href="/docs/getting-started/on-premise/install-innovation-only/multiple-server-with-ha/try-it-out/#test-publishing-production-flows">Testing HA installation</a> or <a href="/docs/getting-started/on-premise/install-innovation-only/single-server-without-ha/try-it-out/#test-publishing-production-flows">Testing non-HA installation</a>. An alternative flow can be used that exists on the system and can be executed.

</div>

<ol>
<li>
<p>Open an HTTP client, such as <a href="https://www.postman.com/downloads/">Postman</a>. Make a request with the following format:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Action</td>
<td>POST</td>
</tr>
<tr>
<td>URL</td>
<td>For HA installation use: <br /><code>https://{FQDN of Load Balancer Server}/api/default/default/flows/{Flow Name}/executions?packageName={Package Name}</code><br />e.g. <code>https://load-balancer&amp;#46;domain&amp;#46;com/api/default/default/flows/NewFlow/executions?packageName=NewPackage</code> <br /><br /> For non-HA installation use: <br /><code>https://{FQDN of server}:8722/api/default/default/flows/{Flow Name}/executions?packageName={Package Name}</code><br />e.g. <code>https://server&amp;#46;domain&amp;#46;com:8722/api/default/default/flows/NewFlow/executions?packageName=NewPackage</code></td>
</tr>
<tr>
<td>Content Type</td>
<td>application/json</td>
</tr>
<tr>
<td>Body</td>
<td>{}</td>
</tr>
<tr>
<td>Authentication</td>
<td>Basic</td>
</tr>
<tr>
<td>Username</td>
<td>The value used for <code>ApiGatewayBasicAuthUserName</code> when installing Application Services. See <a href="/docs/getting-started/on-premise/install-innovation-only/multiple-server-with-ha/install-application-and-loadbalancer-servers#configure-installation-script">HA Installation script configuration</a> or <a href="/docs/getting-started/on-premise/install-innovation-only/single-server-without-ha/install-application-server#configure-installation-script">Non-HA Installation script configuration</a> for the value specified.</td>
</tr>
<tr>
<td>Password</td>
<td>The value used for <code>ApiGatewayBasicAuthPwd</code> when installing Application Services (Unencrypted). See <a href="/docs/getting-started/on-premise/install-innovation-only/multiple-server-with-ha/install-application-and-loadbalancer-servers#configure-installation-script">HA Installation script configuration</a> or <a href="/docs/getting-started/on-premise/install-innovation-only/single-server-without-ha/install-application-server#configure-installation-script">Non-HA Installation script configuration</a> for the value specified.</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If you used self-signed certificates when installing the Application Servers you may need to disable SSL certificate validation in your HTTP client.

</div>

</li>
<li>
<p>Once the request has completed, using a web browser, log in to your configured Grafana.</p>
</li>
<li>
<p>Click the Dashboards icon <img src="/images/DashboardsIcon.png" alt="Dashboards Icon" title="Dashboards Icon"> in the side menu, and then click <em>Browse</em>.</p>
</li>
<li>
<p>Click the folder name that the dashboards were imported to.</p>
</li>
<li>
<p>Click the <em>Flow Execution Requests</em> dashboard to open it.</p>
</li>
<li>
<p>The request made at step 1 should be visible on the dashboard.


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If other requests have been made then there may be more than one request visible on the dashboard.

</div>
</p>
</li>
<li>
<p>Click the Dashboards icon <img src="/images/DashboardsIcon.png" alt="Dashboards Icon" title="Dashboards Icon"> in the side menu, and then click <em>Browse</em>.</p>
</li>
<li>
<p>Click the folder name that the dashboards were imported to.</p>
</li>
<li>
<p>Click the <em>Platform Health</em> dashboard to open it.</p>
</li>
<li>
<p>The request made at step 1 should be visible on the dashboard.


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If other requests have been made then there may be more than one request visible on the dashboard.

</div>
</p>
</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d36d5652578d21bcda9206b5400f43cb">8 - Advanced Setup</h1>
    <div class="lead">Supporting information about installing and configuring a Grafana observability platform for Cortex Innovation.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ac6b22b516ced12a3a2b7e6dd681a138">8.1 - Create Self-Signed Certificates</h1>
    <div class="lead">Information about creating and installing self-signed certificates.</div>
	<h1 id="create-self-signed-certificates">Create Self-Signed Certificates</h1>
<p>Self-signed certificates should be generated using OpenSSL which is bundled in the Cortex Web Application Server Installation Scripts:</p>
<h2 id="setup-openssl-in-powershell">Setup OpenSSL in PowerShell</h2>
<ol>
<li>
<p>Open a Windows PowerShell (x64) window as administrator.</p>
</li>
<li>
<p>Make a directory in which to store the certificates by running the following command, changing the path as required:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">mkdir</span> <span style="color:#000">C:</span><span style="color:#000;font-weight:bold">\</span><span style="color:#000">Certificates</span>
</span></span></code></pre></div></li>
<li>
<p>Navigate PowerShell to inside the certificates folder created above, using the following command, modifying the path as necessary:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#204a87">cd </span><span style="color:#4e9a06">&#34;C:\Certificates&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Temporarily add OpenSSL to the Path environment variable of your system by running the following command, modifying the path according to the location of <code>openssl.exe</code> in the installation scripts on the machine:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">$env:PATH</span> <span style="color:#000;font-weight:bold">+=</span> <span style="color:#4e9a06">&#34;;C:\Cortex Innovation 2022.9 - Web App Server Install Scripts\OpenSSL&#34;</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="generate-the-root-ca-certificate">Generate the Root CA Certificate</h2>
<ol>
<li>
<p>Create the root CA private key by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">genrsa</span> <span style="color:#000">-out</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">4096</span>
</span></span></code></pre></div></li>
<li>
<p>Generate the root CA certificate signed with the private key:</p>
<ol>
<li>
<p>Copy the following text into a text editor:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#000">RANDFILE</span>        <span style="color:#ce5c00;font-weight:bold">=</span> .rnd
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> ca <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_ca</span>      <span style="color:#ce5c00;font-weight:bold">=</span> CA_default    <span style="color:#8f5902;font-style:italic"># The default ca section</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> CA_default <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Directory and file locations.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SHA-1 is deprecated, so use SHA-2 instead.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_md</span>        <span style="color:#ce5c00;font-weight:bold">=</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#000">policy</span>            <span style="color:#ce5c00;font-weight:bold">=</span> policy_strict
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> policy_strict <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The root CA should only sign intermediate certificates that match.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># See the POLICY FORMAT section of `man ca`.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName</span>             <span style="color:#ce5c00;font-weight:bold">=</span> match
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName</span>     <span style="color:#ce5c00;font-weight:bold">=</span> match
</span></span><span style="display:flex;"><span><span style="color:#000">organizationName</span>        <span style="color:#ce5c00;font-weight:bold">=</span> match
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName</span>  <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">commonName</span>              <span style="color:#ce5c00;font-weight:bold">=</span> supplied
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress</span>            <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> req <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Options for the `req` tool (`man req`).</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_bits</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span><span style="display:flex;"><span><span style="color:#000">distinguished_name</span>  <span style="color:#ce5c00;font-weight:bold">=</span> req_distinguished_name
</span></span><span style="display:flex;"><span><span style="color:#000">string_mask</span>         <span style="color:#ce5c00;font-weight:bold">=</span> utf8only
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SHA-1 is deprecated, so use SHA-2 instead.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_md</span>          <span style="color:#ce5c00;font-weight:bold">=</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Extension to add when the -x509 option is used.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x509_extensions</span>     <span style="color:#ce5c00;font-weight:bold">=</span> v3_ca
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> req_distinguished_name <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName</span>             <span style="color:#ce5c00;font-weight:bold">=</span> Country Name <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span> letter code<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_min</span>         <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_max</span>         <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName</span>     <span style="color:#ce5c00;font-weight:bold">=</span> State or Province Name <span style="color:#ce5c00;font-weight:bold">(</span>full name<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">localityName</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Locality Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, city<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>0.organizationName      <span style="color:#ce5c00;font-weight:bold">=</span> Organization Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, company<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName</span>  <span style="color:#ce5c00;font-weight:bold">=</span> Organizational Unit Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, section<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">commonName</span>              <span style="color:#ce5c00;font-weight:bold">=</span> Common Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, your website<span style="color:#a40000">&#39;</span>s domain name<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">commonName_max</span>          <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Email Address
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress_max</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">40</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Optionally, specify some defaults.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_default</span>             <span style="color:#ce5c00;font-weight:bold">=</span> GB
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName_default</span>     <span style="color:#ce5c00;font-weight:bold">=</span> Hampshire
</span></span><span style="display:flex;"><span><span style="color:#000">localityName_default</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Southampton
</span></span><span style="display:flex;"><span>0.organizationName_default      <span style="color:#ce5c00;font-weight:bold">=</span> Cortex Ltd
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName_default</span>  <span style="color:#ce5c00;font-weight:bold">=</span> Cortex 
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress_default</span>            <span style="color:#ce5c00;font-weight:bold">=</span> info@cortex.co.uk
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> v3_ca <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Extensions for a typical CA (`man x509v3_config`).</span>
</span></span><span style="display:flex;"><span><span style="color:#000">subjectKeyIdentifier</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">hash</span>
</span></span><span style="display:flex;"><span><span style="color:#000">authorityKeyIdentifier</span> <span style="color:#ce5c00;font-weight:bold">=</span> keyid:always,issuer
</span></span><span style="display:flex;"><span><span style="color:#000">basicConstraints</span> <span style="color:#ce5c00;font-weight:bold">=</span> critical, CA:true
</span></span><span style="display:flex;"><span><span style="color:#000">keyUsage</span> <span style="color:#ce5c00;font-weight:bold">=</span> critical, digitalSignature, cRLSign, keyCertSign
</span></span></code></pre></div></li>
<li>
<p>Save the file as <code>ca.cnf</code> in the directory created for the certificates above.</p>
</li>
<li>
<p>In the PowerShell window, run the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">req</span> <span style="color:#000">-sha256</span> <span style="color:#000">-x509</span> <span style="color:#000">-new</span> <span style="color:#000">-nodes</span> <span style="color:#000">-key</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">-days</span> <span style="color:#000">3650</span> <span style="color:#000">-out</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pem</span> <span style="color:#000">-config</span> <span style="color:#000">ca</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cnf</span>
</span></span></code></pre></div></li>
<li>
<p>Press <code>Enter</code> for all parameters except the Common Name. For this enter <code>Cortex CA</code>.</p>
</li>
</ol>
</li>
<li>
<p>Package your public and private key in a pkcs12 encrypted file (to install with certmgr on windows) by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">pkcs12</span> <span style="color:#000">-export</span> <span style="color:#000">-inkey</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">-in</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pem</span> <span style="color:#000">-out</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pfx</span>
</span></span></code></pre></div></li>
<li>
<p>Enter a memorable string as the Export Password when asked, this will be needed when adding the certificate to certmgr.</p>
</li>
</ol>
<h2 id="import-the-root-ca-certificate">Import the Root CA Certificate</h2>
<ol>
<li>Double click on the <code>cortexCA.pfx</code> file in the certificates folder to import the certificate into the Windows Certificate Store.</li>
<li>Select <code>Local Machine</code> then click <code>Next</code>.</li>
<li>Click <code>Next</code>.</li>
<li>Enter the Export Password which the certificate was generated with then click <code>Next</code>.</li>
<li>Select <code>Place all certificates in the following store</code>.</li>
<li>Click <code>Browse…</code>.</li>
<li>Select <code>Trusted Root Certification Authorities</code>, click <code>OK</code> then click <code>Next</code>.</li>
<li>Click <code>Finish</code>.</li>
</ol>
<h2 id="generate-the-certificate">Generate the Certificate</h2>
<ol>
<li>
<p>Create a private key for the SSL cert by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">genrsa</span> <span style="color:#000">-out</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">2048</span>
</span></span></code></pre></div></li>
<li>
<p>Generate the SSL certificate request:</p>
<ol>
<li>
<p>Copy the following text into a text editor:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#000">RANDFILE</span>        <span style="color:#ce5c00;font-weight:bold">=</span> .rnd
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> ca <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_ca</span>      <span style="color:#ce5c00;font-weight:bold">=</span> CA_default    <span style="color:#8f5902;font-style:italic"># The default ca section</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> CA_default <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SHA-1 is deprecated, so use SHA-2 instead.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_md</span>        <span style="color:#ce5c00;font-weight:bold">=</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#000">policy</span>            <span style="color:#ce5c00;font-weight:bold">=</span> policy_loose
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> policy_loose <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Allow the intermediate CA to sign a more diverse range of certificates.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># See the POLICY FORMAT section of the `ca` man page.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName</span>             <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName</span>     <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">localityName</span>            <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">organizationName</span>        <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName</span>  <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#000">commonName</span>              <span style="color:#ce5c00;font-weight:bold">=</span> supplied
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress</span>            <span style="color:#ce5c00;font-weight:bold">=</span> optional
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> req <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Options for the `req` tool (`man req`).</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_bits</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span><span style="display:flex;"><span><span style="color:#000">distinguished_name</span>  <span style="color:#ce5c00;font-weight:bold">=</span> req_distinguished_name
</span></span><span style="display:flex;"><span><span style="color:#000">string_mask</span>         <span style="color:#ce5c00;font-weight:bold">=</span> utf8only
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SHA-1 is deprecated, so use SHA-2 instead.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">default_md</span>          <span style="color:#ce5c00;font-weight:bold">=</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Extension to add when the -x509 option is used.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x509_extensions</span>     <span style="color:#ce5c00;font-weight:bold">=</span> v3_req
</span></span><span style="display:flex;"><span><span style="color:#000">req_extensions</span>      <span style="color:#ce5c00;font-weight:bold">=</span> v3_req
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> req_distinguished_name <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName</span>             <span style="color:#ce5c00;font-weight:bold">=</span> Country Name <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span> letter code<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_min</span>         <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_max</span>         <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName</span>     <span style="color:#ce5c00;font-weight:bold">=</span> State or Province Name <span style="color:#ce5c00;font-weight:bold">(</span>full name<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">localityName</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Locality Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, city<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>0.organizationName      <span style="color:#ce5c00;font-weight:bold">=</span> Organization Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, company<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName</span>  <span style="color:#ce5c00;font-weight:bold">=</span> Organizational Unit Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, section<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">commonName</span>              <span style="color:#ce5c00;font-weight:bold">=</span> Common Name <span style="color:#ce5c00;font-weight:bold">(</span>eg, your website<span style="color:#a40000">&#39;</span>s domain name<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">commonName_max</span>          <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Email Address
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress_max</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">40</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Optionally, specify some defaults.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">countryName_default</span>             <span style="color:#ce5c00;font-weight:bold">=</span> GB
</span></span><span style="display:flex;"><span><span style="color:#000">stateOrProvinceName_default</span>     <span style="color:#ce5c00;font-weight:bold">=</span> Hampshire
</span></span><span style="display:flex;"><span><span style="color:#000">localityName_default</span>            <span style="color:#ce5c00;font-weight:bold">=</span> Southampton
</span></span><span style="display:flex;"><span>0.organizationName_default      <span style="color:#ce5c00;font-weight:bold">=</span> Cortex Ltd
</span></span><span style="display:flex;"><span><span style="color:#000">organizationalUnitName_default</span>  <span style="color:#ce5c00;font-weight:bold">=</span> Cortex 
</span></span><span style="display:flex;"><span><span style="color:#000">emailAddress_default</span>            <span style="color:#ce5c00;font-weight:bold">=</span> info@cortex.co.uk
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> v3_req <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">basicConstraints</span> <span style="color:#ce5c00;font-weight:bold">=</span> CA:FALSE
</span></span><span style="display:flex;"><span><span style="color:#000">keyUsage</span> <span style="color:#ce5c00;font-weight:bold">=</span> nonRepudiation, digitalSignature, keyEncipherment
</span></span><span style="display:flex;"><span><span style="color:#000">subjectAltName</span> <span style="color:#ce5c00;font-weight:bold">=</span> @alt_names
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span> alt_names <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Specify all DNS and/or IP addresses that clients can use to access the secured resource.</span>
</span></span><span style="display:flex;"><span>DNS.1 <span style="color:#ce5c00;font-weight:bold">=</span> MACHINE-NAME 
</span></span><span style="display:flex;"><span>DNS.2 <span style="color:#ce5c00;font-weight:bold">=</span> FULLY QUALIFIED MACHINE NAME
</span></span><span style="display:flex;"><span>DNS.3 <span style="color:#ce5c00;font-weight:bold">=</span> localhost 
</span></span><span style="display:flex;"><span>IP.1 <span style="color:#ce5c00;font-weight:bold">=</span> IP ADDRESS
</span></span><span style="display:flex;"><span>IP.2 <span style="color:#ce5c00;font-weight:bold">=</span> 127.0.0.1 
</span></span></code></pre></div></li>
<li>
<p>Modify the section <code>[alt_names]</code> to include all the required DNS names and IP addresses that clients can use to access the secured resource.
Each DNS name or IP address entry must be suffixed with <code>.N</code> where <code>N</code> is the unique index of the DNS name or IP address entry; see below for examples:</p>
<table>
<thead>
<tr>
<th>Resource URL</th>
<th>Configuration to add</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>https://cortex.co.uk/gateway</code></td>
<td><code>DNS.1 = cortex.co.uk</code></td>
</tr>
<tr>
<td><code>https://internal.cortex.co.uk/gateway</code></td>
<td><code>DNS.2 = internal.cortex.co.uk</code></td>
</tr>
<tr>
<td><code>https://10.0.0.0/gateway</code></td>
<td><code>IP.1 = 10.0.0.0</code></td>
</tr>
<tr>
<td><code>https://192.168.1.100/gateway</code></td>
<td><code>IP.2 = 192.168.1.100</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Save the file as <code>san.cnf</code> in the directory created for the certificates above.</p>
</li>
<li>
<p>In the PowerShell window, run the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">req</span> <span style="color:#000">-new</span> <span style="color:#000">-sha256</span> <span style="color:#000">-key</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">-out</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">req</span> <span style="color:#000">-extensions</span> <span style="color:#000">v3_req</span> <span style="color:#000">-config</span> <span style="color:#000">san</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cnf</span>
</span></span></code></pre></div></li>
<li>
<p>Press <code>Enter</code> for everything except the Common Name. For this enter <code>Cortex</code>.</p>
</li>
<li>
<p>Sign the request with a previously generated root CA by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">x509</span> <span style="color:#000">-req</span> <span style="color:#000">-sha256</span> <span style="color:#000">-in</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">req</span> <span style="color:#000">-CA</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pem</span> <span style="color:#000">-CAkey</span> <span style="color:#000">cortexCA</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">-CAcreateserial</span> <span style="color:#000">-out</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pem</span> <span style="color:#000">-days</span> <span style="color:#000">3650</span> <span style="color:#000">-extensions</span> <span style="color:#000">v3_req</span> <span style="color:#000">-extfile</span> <span style="color:#000">san</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cnf</span>
</span></span></code></pre></div></li>
<li>
<p>Package your public and private key in a pkcs12 encrypted file (to install with certmgr on windows) by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#000">openssl</span> <span style="color:#000">pkcs12</span> <span style="color:#000">-export</span> <span style="color:#000">-inkey</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">key</span> <span style="color:#000">-in</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pem</span> <span style="color:#000">-out</span> <span style="color:#000">cortex</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pfx</span>
</span></span></code></pre></div></li>
<li>
<p>Enter a memorable string as the Export Password when asked, this will be needed when adding the certificate to certmgr.</p>
</li>
</ol>
</li>
</ol>
<h2 id="import-the-certificate">Import the Certificate</h2>
<ol>
<li>Double click on the <code>cortex.pfx</code> file in the certificates folder to get the certificate imported to the Windows Certificate Store.</li>
<li>Select <code>Local Machine</code> then click <code>Next</code>.</li>
<li>Click <code>Next</code>.</li>
<li>Enter the Export Password which the certificate was generated with then click <code>Next</code>.</li>
<li>Select <code>Place all certificates in the following store</code>.</li>
<li>Click <code>Browse…</code>.</li>
<li>Select <code>Personal</code>, click <code>OK</code> then click <code>Next</code>.</li>
<li>Click <code>Finish</code>.</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2fd180e7b945d096940590807e716e77">8.2 - Port Requirements for the Web Application Server</h1>
    <div class="lead">Information about the ports to be opened when installing the Grafana observability platform.</div>
	<h1 id="port-requirements-for-the-web-application-server">Port Requirements for the Web Application Server</h1>
<p>All the required ports for the Web Application Server that forms part of the Grafana observability platform must be opened on any installed firewall. If any other firewall exists between the Application Servers and the Web Application Server, or Grafana users and the Web Application Server, it will be necessary to configure this selection of rules on it.  These ports may be altered if there are any conflicts with other application requirements.</p>
<h2 id="grafana-observability-platform">Grafana Observability Platform</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Default Port(s)</th>
<th>Protocol</th>
<th>Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Grafana</td>
<td>The port used by the Grafana web application</td>
<td>3000</td>
<td>TCP</td>
<td>Inbound</td>
</tr>
<tr>
<td>Reverse proxy for Grafana Loki</td>
<td>The port used by IIS serving the role of a reverse proxy for Grafana Loki</td>
<td>2100</td>
<td>TCP</td>
<td>Inbound</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d01c6456d2bf3ab4802e0e9bc8b3b049">8.3 - SSL Best Practices</h1>
    <div class="lead">Information about the recommended security settings for the Grafana observability platform servers.</div>
	<h1 id="ssl-best-practices">SSL Best Practices</h1>
<p>A collection of registry settings can be applied during installation to guarantee your server is only using the recommended encryption algorithms and TLS protocols:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
<th>Enabled</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ciphers</td>
<td>AES 128/128</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>AES 256/256</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>Triple DES 168</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>DES 56/56</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>NULL</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC2 128/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC2 40/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC2 56/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC4 128/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC4 40/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC4 56/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>RC4 64/128</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hashes</td>
<td>MD5</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>SHA</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>SHA256</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>SHA384</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>SHA512</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>KeyExchangeAlgorithms</td>
<td>Diffie-Hellman</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>ECDH</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>PKCS</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Protocols</td>
<td>Multi-Protocol Unified Hello</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>PCT 1.0</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>SSL 2.0</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>SSL 3.0</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS 1.0</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS 1.1</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS 1.2</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Cipher Suites</td>
<td>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</td>
<td>✓</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA25</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_RSA_WITH_AES_256_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_RSA_WITH_AES_128_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_256_GCM_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_128_GCM_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_256_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_128_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_256_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_AES_128_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_3DES_EDE_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_DSS_WITH_AES_128_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_DSS_WITH_AES_256_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_DSS_WITH_AES_128_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_RC4_128_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_RC4_128_MD5</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_NULL_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_RSA_WITH_NULL_SHA</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_AES_256_GCM_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_AES_128_GCM_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_AES_256_CBC_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_AES_128_CBC_SHA256</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_NULL_SHA384</td>
<td>✕</td>
</tr>
<tr>
<td></td>
<td>TLS_PSK_WITH_NULL_SHA256</td>
<td>✕</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Warning</h4>

    Disabling specific TLS versions or specific Cipher Suites can have impact on other applications as well as their communication capabilities with third party systems and services. All parties communicating together must support a shared protocol version and cipher suite, otherwise they will not be able to establish a secure communication link between each other.

</div>


</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      

<footer class="bg-dark row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-12 col-sm-12 text-center py-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/cortex_software">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Facebook" aria-label="Facebook">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/cortexintelligentautomation/">
      <i class="fab fa-facebook"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Vimeo" aria-label="Vimeo">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://vimeo.com/cortexautomationsoftware">
      <i class="fab fa-vimeo"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/10975051">
      <i class="fab fa-linkedin"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="YouTube" aria-label="YouTube">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/channel/UCZwlagVEozhAjmUySYx8YlA">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
    </div>
    <div class="row">
      <div class="col-6 col-sm-6 text-xs-center order-sm-1">
        
        
        
<ul class="list-unstyled">
  
  <li data-toggle="tooltip" data-placement="top" aria-label="Privacy Policy">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.cortex-ia.com/gdpr-privacy-policy/">
      Privacy Policy
    </a>
  </li>
  
  <li data-toggle="tooltip" data-placement="top" aria-label="Terms and Conditions">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.cortex-ia.com/terms-conditions/">
      Terms and Conditions
    </a>
  </li>
  
  <li data-toggle="tooltip" data-placement="top" aria-label="Disclaimer">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.cortex-ia.com/disclaimer/">
      Disclaimer
    </a>
  </li>
  
  <li data-toggle="tooltip" data-placement="top" aria-label="Registration Number: 05023238">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://find-and-update.company-information.service.gov.uk/company/05023238">
      Registration Number: 05023238
    </a>
  </li>
  
  <li data-toggle="tooltip" data-placement="top" aria-label="VAT Number: GB204612157">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.tax.service.gov.uk/check-vat-number/enter-vat-details">
      VAT Number: GB204612157
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-6 text-right text-xs-center order-sm-2"> 
        <ul class="list-unstyled">
          
            
  <li class="text-white" data-toggle="tooltip" data-placement="top" aria-label="22 Kings Park Road">
      22 Kings Park Road
  </li>

            
  <li class="text-white" data-toggle="tooltip" data-placement="top" aria-label="Southampton, SO15 2AT">
      Southampton, SO15 2AT
  </li>

            
  <li class="text-white" data-toggle="tooltip" data-placement="top" aria-label="&#43;44 23 8254 8990">
      &#43;44 23 8254 8990
  </li>

            
  <li class="text-white" data-toggle="tooltip" data-placement="top" aria-label="info@cortex-ia.com">
      info@cortex-ia.com
  </li>

            
  <li class="text-white" data-toggle="tooltip" data-placement="top" aria-label="Southampton, SO15 2AT">
      Southampton, SO15 2AT
  </li>

          
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-sm-12 text-center order-sm-1 copyright-container">
        Copyright &copy; 2022 Cortex Limited. All Rights Reserved
	
      </div>
    </div>
  </div>
</footer>






    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/js/main.min.357cdcbd77fb614ceb215987dafe216ba8720b4aa10ecd38bccb7c0013e32f2a.js" integrity="sha256-NXzcvXf7YUzrIVmH2v4ha6hyC0qhDs04vMt8ABPjLyo=" crossorigin="anonymous"></script>




  </body>
</html>
